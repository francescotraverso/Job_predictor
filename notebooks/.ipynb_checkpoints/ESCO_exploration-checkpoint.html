{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e72a636c",
   "metadata": {},
   "outputs": [],
   "source": [
    "### DON'T DO \"RESTART AND RUN ALL CELLS\" ON THIS NOTEBOOK ###\n",
    "### THERE'S A CELL THAT TAKES VERY LONG TO RUN AND IT ONLY NEEDED TO BE RUN ONCE ###"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 748,
   "id": "fbc18917",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import requests\n",
    "import string\n",
    "import collections\n",
    "import random\n",
    "import time\n",
    "from tqdm import tqdm\n",
    "from gensim.models.doc2vec import Doc2Vec, TaggedDocument\n",
    "from gensim.models.word2vec import Word2Vec\n",
    "from gensim.models import KeyedVectors\n",
    "from gensim.utils import simple_preprocess\n",
    "import nltk\n",
    "from nltk import word_tokenize\n",
    "from nltk.corpus import stopwords\n",
    "from nltk.stem import WordNetLemmatizer\n",
    "from textaugment import Wordnet"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 745,
   "id": "c1f5bccc",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/var/folders/84/1j64f6yd3yd5g68_pj91ch780000gn/T/ipykernel_76619/3036819475.py:5: DtypeWarning: Columns (12) have mixed types. Specify dtype option on import or set low_memory=False.\n",
      "  df_occ_n_skills = pd.read_csv('../data/ESCO/occupations_augmented_with_skills.csv')\n"
     ]
    }
   ],
   "source": [
    "# get dataframes from CSV files\n",
    "\n",
    "df_occupations = pd.read_csv('../data/ESCO/occupations_en.csv')\n",
    "df_occupations_aug = pd.read_csv('../data/ESCO/occupations_augmented.csv')\n",
    "df_occ_n_skills = pd.read_csv('../data/ESCO/occupations_augmented_with_skills.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 746,
   "id": "ed2dafa8",
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>job_title</th>\n",
       "      <th>description</th>\n",
       "      <th>skills</th>\n",
       "      <th>description_input</th>\n",
       "      <th>skills_input</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>technical director</td>\n",
       "      <td>Technical directors realise the artistic visio...</td>\n",
       "      <td>adapt to artists' creative demands, organise r...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>metal drawing machine operator</td>\n",
       "      <td>Metal drawing machine operators set up and ope...</td>\n",
       "      <td>cold drawing processes, monitor moving workpie...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>precision device inspector</td>\n",
       "      <td>Precision device inspectors make sure precisio...</td>\n",
       "      <td>precision measuring instruments, monitor machi...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>air traffic safety technician</td>\n",
       "      <td>Air traffic safety technicians provide technic...</td>\n",
       "      <td>air transport law, aircraft flight control sys...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>hospitality revenue manager</td>\n",
       "      <td>Hospitality revenue managers maximise revenue ...</td>\n",
       "      <td>develop revenue generation strategies, ensure ...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                        job_title  \\\n",
       "0              technical director   \n",
       "1  metal drawing machine operator   \n",
       "2      precision device inspector   \n",
       "3   air traffic safety technician   \n",
       "4     hospitality revenue manager   \n",
       "\n",
       "                                         description  \\\n",
       "0  Technical directors realise the artistic visio...   \n",
       "1  Metal drawing machine operators set up and ope...   \n",
       "2  Precision device inspectors make sure precisio...   \n",
       "3  Air traffic safety technicians provide technic...   \n",
       "4  Hospitality revenue managers maximise revenue ...   \n",
       "\n",
       "                                              skills  description_input  \\\n",
       "0  adapt to artists' creative demands, organise r...                  0   \n",
       "1  cold drawing processes, monitor moving workpie...                  0   \n",
       "2  precision measuring instruments, monitor machi...                  0   \n",
       "3  air transport law, aircraft flight control sys...                  0   \n",
       "4  develop revenue generation strategies, ensure ...                  0   \n",
       "\n",
       "   skills_input  \n",
       "0             0  \n",
       "1             0  \n",
       "2             0  \n",
       "3             0  \n",
       "4             0  "
      ]
     },
     "execution_count": 746,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_occ_n_skills = df_occ_n_skills.filter(items=['preferredLabel', 'description', 'skills'])\n",
    "df_occ_n_skills = df_occ_n_skills.reindex(columns=['preferredLabel','description', 'skills'])\n",
    "df_occ_n_skills.rename(columns={'preferredLabel': 'job_title'}, inplace=True)\n",
    "df_occ_n_skills['description_input'] = 0\n",
    "df_occ_n_skills['skills_input'] = 0\n",
    "df_occ_n_skills.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 786,
   "id": "e8b1d26d",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "35824it [00:05, 6719.17it/s]\n"
     ]
    }
   ],
   "source": [
    "# create description_input and skills_input, which are strings on which the model will be fit\n",
    "\n",
    "for row, index in tqdm(df_occ_n_skills.iterrows()):\n",
    "    underscored_job_title = index['job_title'].replace(\" \", \"_\")\n",
    "    this_rows_description_input = underscored_job_title + ' ' + index['description']\n",
    "    this_rows_skills_input = underscored_job_title + ' ' + index['skills']\n",
    "    df_occ_n_skills.iloc[row,-2] = this_rows_description_input\n",
    "    df_occ_n_skills.iloc[row,-1] = this_rows_skills_input"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 787,
   "id": "e82072dd",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>job_title</th>\n",
       "      <th>description</th>\n",
       "      <th>skills</th>\n",
       "      <th>description_input</th>\n",
       "      <th>skills_input</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>technical director</td>\n",
       "      <td>Technical directors realise the artistic visio...</td>\n",
       "      <td>adapt to artists' creative demands, organise r...</td>\n",
       "      <td>technical_director Technical directors realise...</td>\n",
       "      <td>technical_director adapt to artists' creative ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>metal drawing machine operator</td>\n",
       "      <td>Metal drawing machine operators set up and ope...</td>\n",
       "      <td>cold drawing processes, monitor moving workpie...</td>\n",
       "      <td>metal_drawing_machine_operator Metal drawing m...</td>\n",
       "      <td>metal_drawing_machine_operator cold drawing pr...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>precision device inspector</td>\n",
       "      <td>Precision device inspectors make sure precisio...</td>\n",
       "      <td>precision measuring instruments, monitor machi...</td>\n",
       "      <td>precision_device_inspector Precision device in...</td>\n",
       "      <td>precision_device_inspector precision measuring...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>air traffic safety technician</td>\n",
       "      <td>Air traffic safety technicians provide technic...</td>\n",
       "      <td>air transport law, aircraft flight control sys...</td>\n",
       "      <td>air_traffic_safety_technician Air traffic safe...</td>\n",
       "      <td>air_traffic_safety_technician air transport la...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>hospitality revenue manager</td>\n",
       "      <td>Hospitality revenue managers maximise revenue ...</td>\n",
       "      <td>develop revenue generation strategies, ensure ...</td>\n",
       "      <td>hospitality_revenue_manager Hospitality revenu...</td>\n",
       "      <td>hospitality_revenue_manager develop revenue ge...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                        job_title  \\\n",
       "0              technical director   \n",
       "1  metal drawing machine operator   \n",
       "2      precision device inspector   \n",
       "3   air traffic safety technician   \n",
       "4     hospitality revenue manager   \n",
       "\n",
       "                                         description  \\\n",
       "0  Technical directors realise the artistic visio...   \n",
       "1  Metal drawing machine operators set up and ope...   \n",
       "2  Precision device inspectors make sure precisio...   \n",
       "3  Air traffic safety technicians provide technic...   \n",
       "4  Hospitality revenue managers maximise revenue ...   \n",
       "\n",
       "                                              skills  \\\n",
       "0  adapt to artists' creative demands, organise r...   \n",
       "1  cold drawing processes, monitor moving workpie...   \n",
       "2  precision measuring instruments, monitor machi...   \n",
       "3  air transport law, aircraft flight control sys...   \n",
       "4  develop revenue generation strategies, ensure ...   \n",
       "\n",
       "                                   description_input  \\\n",
       "0  technical_director Technical directors realise...   \n",
       "1  metal_drawing_machine_operator Metal drawing m...   \n",
       "2  precision_device_inspector Precision device in...   \n",
       "3  air_traffic_safety_technician Air traffic safe...   \n",
       "4  hospitality_revenue_manager Hospitality revenu...   \n",
       "\n",
       "                                        skills_input  \n",
       "0  technical_director adapt to artists' creative ...  \n",
       "1  metal_drawing_machine_operator cold drawing pr...  \n",
       "2  precision_device_inspector precision measuring...  \n",
       "3  air_traffic_safety_technician air transport la...  \n",
       "4  hospitality_revenue_manager develop revenue ge...  "
      ]
     },
     "execution_count": 787,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_occ_n_skills.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 788,
   "id": "8c0565d3",
   "metadata": {},
   "outputs": [],
   "source": [
    "# get entire dataframe as dataset according to Qiewi's suggestion\n",
    "# concatenate the job_title:skills list to the end of df_occ_n_skills\n",
    "\n",
    "X_all = pd.concat([df_occ_n_skills['description_input'], df_occ_n_skills['skills_input']]).reset_index(drop=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 678,
   "id": "5223109b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "***** SKILL LIST: ['manage animal biosecurity', 'animal nutrition', 'monitor the welfare of animals', 'create animal records', 'health and safety regulations', 'manage pig breeding', 'control animal movement', 'feed livestock', 'provide nutrition to animals', 'provide first aid to animals', 'select livestock', 'monitor livestock', 'manage the health and welfare of livestock', 'assist animal birth', 'assist in transportation of animals', 'carry out specialised procedures for pigs', 'livestock reproduction', 'dispose of dead animals', 'livestock feeding', 'maintain professional records', 'operate farm equipment', 'administer treatment to animals', 'care for juvenile animals', 'manage livestock', 'maintain animal accommodation', 'livestock species', 'manage animal hygiene', 'signs of animal illness', 'administer specific drugs to facilitate breeding', 'animal welfare legislation']\n",
      "***** ALTERNATIVE LABELS: ['pig breeders', 'pig specialist', 'pig rearer']\n",
      "***** JOB DESCRIPTION: Pig breeders oversee the production and day-to-day care of pigs. They maintain the health and welfare of pigs.\n"
     ]
    }
   ],
   "source": [
    "### run this cell & extract skills, alternative labels, and job description from the ESCO API ###\n",
    "### this cell uses the original occupations dataframe (not augmented) ###\n",
    "\n",
    "# select a role\n",
    "role = 'pig breeder'\n",
    "\n",
    "# get uri for selected role\n",
    "role_extract = df_occupations[df_occupations['preferredLabel'] == role]\n",
    "role_uri = role_extract['conceptUri']\n",
    "\n",
    "# get role information from the ESCO API\n",
    "url = \"https://ec.europa.eu/esco/api/resource/skill\"\n",
    "params = {\n",
    "    'uri': role_uri,\n",
    "    'language': 'en'\n",
    "         }\n",
    "api_skills = requests.get(url=url, params=params).json()\n",
    "\n",
    "# this line gets you the whole API url; easier to read on your browser\n",
    "requests.get(url=url, params=params).url\n",
    "\n",
    "# gets a list of all skill descriptions and extracts the skill title only\n",
    "api_skills_dict = api_skills.get('_links').get('hasEssentialSkill')\n",
    "skills_list = [skill.get('title') for skill in api_skills_dict]\n",
    "\n",
    "# gets list of alternative labels from the API\n",
    "alt_labels_list = api_skills.get('alternativeLabel').get('en')\n",
    "\n",
    "# gets job description from the API\n",
    "job_description = api_skills.get('description').get('en').get('literal')\n",
    "\n",
    "print('***** SKILL LIST:', skills_list)\n",
    "print('***** ALTERNATIVE LABELS:', alt_labels_list)\n",
    "print('***** JOB DESCRIPTION:', job_description)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "522a0c7b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Preprocessing function for job descriptions\n",
    "\n",
    "def preprocessing(sentence):\n",
    "    \n",
    "    # remove punctuation\n",
    "    for punctuation in string.punctuation:        \n",
    "        sentence = sentence.replace(punctuation, '')\n",
    "    \n",
    "    # set lowercase\n",
    "    sentence = sentence.lower()\n",
    "    \n",
    "    # remove numbers\n",
    "    sentence = ''.join(char for char in sentence if not char.isdigit())\n",
    "    \n",
    "    # remove stopwords\n",
    "    stop_words = set(stopwords.words('english'))\n",
    "    tokens = word_tokenize(sentence)\n",
    "    stopword_free_tokens = [token for token in tokens if token not in stop_words]\n",
    "    sentence = ' '.join(stopword_free_tokens)\n",
    "\n",
    "    # lemmatize\n",
    "    sentence = WordNetLemmatizer().lemmatize(sentence, pos='n')\n",
    "    sentence = WordNetLemmatizer().lemmatize(sentence, pos='v')\n",
    "    \n",
    "    # split into tokens again after Lemmatizing\n",
    "    sentence = word_tokenize(sentence)\n",
    "    \n",
    "    return sentence"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 842,
   "id": "30fc9176",
   "metadata": {},
   "outputs": [],
   "source": [
    "# applying preprocessing as in Gensim tutorial\n",
    "\n",
    "def read_corpus(corpus, tokens_only=False):\n",
    "    for i, line in enumerate(corpus):\n",
    "        tokens = preprocessing(line)\n",
    "        if tokens_only:\n",
    "            yield tokens\n",
    "        else:\n",
    "            # For training data, add tags\n",
    "            yield TaggedDocument(tokens, [i])\n",
    "\n",
    "all_corpus = list(read_corpus(X_all))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 847,
   "id": "0e8eceef",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<gensim.models.keyedvectors.KeyedVectors at 0x1482bcf70>"
      ]
     },
     "execution_count": 847,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# initialize 'job2vec' model\n",
    "\n",
    "job2vec_model = Doc2Vec(\n",
    "    vector_size=70,\n",
    "    min_count=5,\n",
    "    epochs=100,\n",
    "    window=20,\n",
    "    alpha=0.01,\n",
    "    dm_concat=1,\n",
    "    shrink_windows=True)\n",
    "\n",
    "job2vec_model.wv"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 850,
   "id": "8b65001e",
   "metadata": {},
   "outputs": [],
   "source": [
    "# build vocabulary\n",
    "\n",
    "job2vec_model.build_vocab(all_corpus)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 851,
   "id": "4790bb85",
   "metadata": {},
   "outputs": [],
   "source": [
    "# train model!\n",
    "\n",
    "job2vec_model.train(\n",
    "    all_corpus,\n",
    "    total_examples=job2vec_model.corpus_count,\n",
    "    epochs=job2vec_model.epochs\n",
    "    )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 852,
   "id": "0776e260",
   "metadata": {},
   "outputs": [],
   "source": [
    "# describe your job and get your prediction!\n",
    "\n",
    "describe_your_job = \\\n",
    "\"Management consultancy specialized in food & beverage Consulting services for restaurants, bars\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 853,
   "id": "272d934b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# preprocess your job description\n",
    "new_description = preprocessing(describe_your_job)\n",
    "\n",
    "# create inferred vector from your preprocessed job description\n",
    "new_inferred_vector = job2vec_model.infer_vector(new_description)\n",
    "\n",
    "# get similar job descriptions from model\n",
    "similar_to_new = job2vec_model.dv.most_similar([new_inferred_vector], topn=len(job2vec_model.dv))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 854,
   "id": "1984fc36",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[(56860, 0.7782288193702698),\n",
       " (42328, 0.7638508081436157),\n",
       " (67825, 0.7597503662109375),\n",
       " (56842, 0.7521565556526184),\n",
       " (54844, 0.7496419548988342),\n",
       " (66993, 0.7470423579216003),\n",
       " (63847, 0.7356422543525696),\n",
       " (36258, 0.735197901725769),\n",
       " (50375, 0.7345724105834961),\n",
       " (35960, 0.7320992946624756),\n",
       " (43098, 0.730851948261261),\n",
       " (66992, 0.716944694519043),\n",
       " (47562, 0.7153379321098328),\n",
       " (44594, 0.7097679972648621),\n",
       " (55714, 0.7085069417953491),\n",
       " (71640, 0.7064688801765442),\n",
       " (50378, 0.7029867768287659),\n",
       " (63851, 0.7011147737503052),\n",
       " (61940, 0.6994743943214417),\n",
       " (44257, 0.6983118057250977),\n",
       " (44252, 0.6981230974197388),\n",
       " (39754, 0.6944125294685364),\n",
       " (44258, 0.6944062113761902),\n",
       " (67007, 0.6940516829490662),\n",
       " (62571, 0.6928393244743347),\n",
       " (47502, 0.6920349597930908),\n",
       " (45568, 0.68951815366745),\n",
       " (43898, 0.6881887912750244),\n",
       " (56729, 0.6874176263809204),\n",
       " (44545, 0.6848641633987427),\n",
       " (59530, 0.6832793951034546),\n",
       " (44539, 0.6828984618186951),\n",
       " (58371, 0.681503415107727),\n",
       " (66941, 0.6814749836921692),\n",
       " (54847, 0.6812378168106079),\n",
       " (71524, 0.6811752915382385),\n",
       " (69213, 0.6809391379356384),\n",
       " (65748, 0.6805441975593567),\n",
       " (45566, 0.679620623588562),\n",
       " (66996, 0.678871750831604),\n",
       " (42087, 0.6758170127868652),\n",
       " (69414, 0.6744017004966736),\n",
       " (67829, 0.6731612086296082),\n",
       " (61249, 0.6727104783058167),\n",
       " (46932, 0.6723628640174866),\n",
       " (42134, 0.6723057627677917),\n",
       " (36657, 0.6721901893615723),\n",
       " (51434, 0.6720117926597595),\n",
       " (38831, 0.6677485704421997),\n",
       " (50697, 0.6673420071601868),\n",
       " (42040, 0.6668985486030579),\n",
       " (53595, 0.6647073030471802),\n",
       " (59082, 0.6640778183937073),\n",
       " (65691, 0.6632997989654541),\n",
       " (60234, 0.6612717509269714),\n",
       " (39600, 0.6612564921379089),\n",
       " (50376, 0.6610568165779114),\n",
       " (58991, 0.6606087684631348),\n",
       " (45767, 0.6602116823196411),\n",
       " (39756, 0.6600303053855896),\n",
       " (42090, 0.6588494777679443),\n",
       " (61925, 0.6579573750495911),\n",
       " (44259, 0.6578484177589417),\n",
       " (43671, 0.6572871208190918),\n",
       " (52530, 0.6557887196540833),\n",
       " (67002, 0.655437707901001),\n",
       " (36702, 0.6549686789512634),\n",
       " (56857, 0.6538705825805664),\n",
       " (44254, 0.6534122824668884),\n",
       " (39233, 0.6523401141166687),\n",
       " (36320, 0.651079535484314),\n",
       " (60656, 0.6506196856498718),\n",
       " (55712, 0.6498509049415588),\n",
       " (69224, 0.6491069793701172),\n",
       " (71630, 0.6478604674339294),\n",
       " (67010, 0.6464737057685852),\n",
       " (69710, 0.645228385925293),\n",
       " (45300, 0.6445016264915466),\n",
       " (65746, 0.6442327499389648),\n",
       " (54038, 0.6440526247024536),\n",
       " (56734, 0.6428789496421814),\n",
       " (71639, 0.6421028971672058),\n",
       " (26447, 0.6419419646263123),\n",
       " (46936, 0.6417787075042725),\n",
       " (37650, 0.6417017579078674),\n",
       " (60589, 0.6415656208992004),\n",
       " (67827, 0.6405064463615417),\n",
       " (47975, 0.6403201818466187),\n",
       " (58987, 0.6391337513923645),\n",
       " (37867, 0.6382657289505005),\n",
       " (60133, 0.6374194622039795),\n",
       " (52908, 0.6372500061988831),\n",
       " (67003, 0.6363331079483032),\n",
       " (63867, 0.6356707811355591),\n",
       " (65747, 0.6339067220687866),\n",
       " (65742, 0.6336801648139954),\n",
       " (58204, 0.6335208415985107),\n",
       " (54024, 0.6317219734191895),\n",
       " (55711, 0.6316501498222351),\n",
       " (52425, 0.6316148638725281),\n",
       " (62482, 0.6314359307289124),\n",
       " (42088, 0.6296930313110352),\n",
       " (51572, 0.6289258003234863),\n",
       " (55825, 0.628505527973175),\n",
       " (46507, 0.6281313896179199),\n",
       " (55986, 0.6280257105827332),\n",
       " (56029, 0.6273560523986816),\n",
       " (54846, 0.6267194151878357),\n",
       " (52660, 0.6258537769317627),\n",
       " (64750, 0.6254240274429321),\n",
       " (44253, 0.6250894069671631),\n",
       " (55976, 0.6250829696655273),\n",
       " (49076, 0.6248143911361694),\n",
       " (29298, 0.6243717670440674),\n",
       " (63829, 0.6243504881858826),\n",
       " (67742, 0.6233006715774536),\n",
       " (62370, 0.6232516169548035),\n",
       " (40902, 0.6228017807006836),\n",
       " (62491, 0.622718870639801),\n",
       " (38514, 0.6225293278694153),\n",
       " (50377, 0.622366726398468),\n",
       " (44900, 0.6219315528869629),\n",
       " (40366, 0.621878445148468),\n",
       " (67747, 0.6213957071304321),\n",
       " (61926, 0.6212830543518066),\n",
       " (44243, 0.6206123232841492),\n",
       " (42036, 0.6203833222389221),\n",
       " (60654, 0.6203272342681885),\n",
       " (66999, 0.6189287900924683),\n",
       " (42332, 0.6185253858566284),\n",
       " (67828, 0.6184212565422058),\n",
       " (66998, 0.6184138059616089),\n",
       " (61076, 0.6182433366775513),\n",
       " (50250, 0.6181498765945435),\n",
       " (55341, 0.617975652217865),\n",
       " (71327, 0.6174014806747437),\n",
       " (46933, 0.6172379851341248),\n",
       " (54453, 0.61594557762146),\n",
       " (59097, 0.6158186793327332),\n",
       " (63875, 0.6158026456832886),\n",
       " (35091, 0.6145603060722351),\n",
       " (61929, 0.6142224073410034),\n",
       " (53591, 0.6137945652008057),\n",
       " (5315, 0.6136472821235657),\n",
       " (57666, 0.6117461919784546),\n",
       " (51577, 0.6114900708198547),\n",
       " (29306, 0.6110995411872864),\n",
       " (47496, 0.6110323667526245),\n",
       " (71641, 0.6096963882446289),\n",
       " (62483, 0.6094183325767517),\n",
       " (51455, 0.60917729139328),\n",
       " (49073, 0.6090109348297119),\n",
       " (23409, 0.6086330413818359),\n",
       " (50380, 0.6080529093742371),\n",
       " (70994, 0.6076955795288086),\n",
       " (68396, 0.6074850559234619),\n",
       " (50379, 0.6070449948310852),\n",
       " (69715, 0.6067603826522827),\n",
       " (47161, 0.6059727668762207),\n",
       " (61850, 0.605492889881134),\n",
       " (69216, 0.6054600477218628),\n",
       " (66115, 0.6053324937820435),\n",
       " (51007, 0.6047987341880798),\n",
       " (62369, 0.6046096086502075),\n",
       " (67904, 0.6045241951942444),\n",
       " (45763, 0.6045045852661133),\n",
       " (55987, 0.6041167974472046),\n",
       " (49092, 0.6041125059127808),\n",
       " (51737, 0.6031612753868103),\n",
       " (54599, 0.602789044380188),\n",
       " (58368, 0.6025984287261963),\n",
       " (46934, 0.6021826863288879),\n",
       " (54595, 0.6015965342521667),\n",
       " (69420, 0.6014800667762756),\n",
       " (37056, 0.5996058583259583),\n",
       " (38805, 0.599553644657135),\n",
       " (53938, 0.599545955657959),\n",
       " (61928, 0.5994541049003601),\n",
       " (62472, 0.5989617109298706),\n",
       " (66362, 0.5989242196083069),\n",
       " (38478, 0.5988366007804871),\n",
       " (63298, 0.5985460877418518),\n",
       " (61226, 0.5981501936912537),\n",
       " (48986, 0.5980655550956726),\n",
       " (54849, 0.597514271736145),\n",
       " (36295, 0.5970829725265503),\n",
       " (40352, 0.5967230200767517),\n",
       " (71025, 0.5965816378593445),\n",
       " (39985, 0.5963972806930542),\n",
       " (51448, 0.5961689949035645),\n",
       " (38621, 0.5959709882736206),\n",
       " (59380, 0.5939300656318665),\n",
       " (56851, 0.5934171080589294),\n",
       " (46073, 0.5929890275001526),\n",
       " (61073, 0.5917084217071533),\n",
       " (44540, 0.5914577841758728),\n",
       " (44604, 0.5911439657211304),\n",
       " (59895, 0.5908007621765137),\n",
       " (67740, 0.5901098251342773),\n",
       " (61251, 0.5901059508323669),\n",
       " (42420, 0.5896804928779602),\n",
       " (37870, 0.5894478559494019),\n",
       " (37715, 0.5892736315727234),\n",
       " (39947, 0.5892589688301086),\n",
       " (67008, 0.5891908407211304),\n",
       " (64364, 0.5887358784675598),\n",
       " (59527, 0.5886015892028809),\n",
       " (35807, 0.588189423084259),\n",
       " (71282, 0.5880906581878662),\n",
       " (53248, 0.5872126817703247),\n",
       " (59787, 0.5867691040039062),\n",
       " (68264, 0.5866871476173401),\n",
       " (59907, 0.5866390466690063),\n",
       " (18888, 0.5863046646118164),\n",
       " (6059, 0.5861190557479858),\n",
       " (36079, 0.5860745906829834),\n",
       " (67901, 0.5855723023414612),\n",
       " (45569, 0.5854321718215942),\n",
       " (36946, 0.5853588581085205),\n",
       " (38436, 0.5851709246635437),\n",
       " (49025, 0.5851047039031982),\n",
       " (56843, 0.5843403935432434),\n",
       " (44255, 0.5840626955032349),\n",
       " (52892, 0.5839639902114868),\n",
       " (50374, 0.5837326049804688),\n",
       " (64969, 0.5837111473083496),\n",
       " (42011, 0.583574116230011),\n",
       " (54047, 0.5835498571395874),\n",
       " (50239, 0.5834124684333801),\n",
       " (56850, 0.5833012461662292),\n",
       " (37047, 0.5830510258674622),\n",
       " (48628, 0.5816910862922668),\n",
       " (36129, 0.5814791321754456),\n",
       " (71063, 0.5812541246414185),\n",
       " (51013, 0.5808583498001099),\n",
       " (54954, 0.5803557634353638),\n",
       " (66080, 0.5800739526748657),\n",
       " (69281, 0.5800635814666748),\n",
       " (49091, 0.5798279643058777),\n",
       " (59905, 0.5794873237609863),\n",
       " (55340, 0.5790202617645264),\n",
       " (42086, 0.5785679221153259),\n",
       " (58762, 0.578484058380127),\n",
       " (44256, 0.5783585906028748),\n",
       " (64174, 0.5783254504203796),\n",
       " (44537, 0.5781327486038208),\n",
       " (58677, 0.5780665278434753),\n",
       " (42089, 0.5777139067649841),\n",
       " (42577, 0.5771869421005249),\n",
       " (59891, 0.5759814977645874),\n",
       " (5700, 0.57589191198349),\n",
       " (58046, 0.5756973624229431),\n",
       " (51718, 0.5756617784500122),\n",
       " (61934, 0.5749247074127197),\n",
       " (55715, 0.5748885273933411),\n",
       " (39242, 0.5746611952781677),\n",
       " (43905, 0.5738599896430969),\n",
       " (45775, 0.5738452076911926),\n",
       " (59680, 0.5735656023025513),\n",
       " (41944, 0.5733656883239746),\n",
       " (67734, 0.572952926158905),\n",
       " (67073, 0.5725627541542053),\n",
       " (51436, 0.5722014307975769),\n",
       " (62368, 0.5715502500534058),\n",
       " (40351, 0.5705950856208801),\n",
       " (56728, 0.5705451369285583),\n",
       " (63864, 0.5698544979095459),\n",
       " (61910, 0.5694997906684875),\n",
       " (66321, 0.5694132447242737),\n",
       " (61941, 0.5687081813812256),\n",
       " (60910, 0.5685378313064575),\n",
       " (62489, 0.5678427219390869),\n",
       " (45303, 0.5673617720603943),\n",
       " (63805, 0.5670056939125061),\n",
       " (60759, 0.566774308681488),\n",
       " (61254, 0.5666085481643677),\n",
       " (61937, 0.5665923953056335),\n",
       " (29300, 0.5663413405418396),\n",
       " (44260, 0.5662581920623779),\n",
       " (67196, 0.5659102201461792),\n",
       " (49032, 0.5656318664550781),\n",
       " (58642, 0.5656307339668274),\n",
       " (39501, 0.5654157400131226),\n",
       " (28093, 0.5653133392333984),\n",
       " (62074, 0.5651381611824036),\n",
       " (47495, 0.5650006532669067),\n",
       " (43891, 0.5649165511131287),\n",
       " (51262, 0.5647293925285339),\n",
       " (49080, 0.5646476745605469),\n",
       " (65745, 0.5644816160202026),\n",
       " (53589, 0.5641502141952515),\n",
       " (45762, 0.5639509558677673),\n",
       " (60380, 0.563769519329071),\n",
       " (42045, 0.5633864998817444),\n",
       " (45777, 0.5633488297462463),\n",
       " (57750, 0.5632839798927307),\n",
       " (44003, 0.5631071329116821),\n",
       " (46929, 0.5628116726875305),\n",
       " (46171, 0.5619096159934998),\n",
       " (49070, 0.5615451335906982),\n",
       " (44984, 0.5611238479614258),\n",
       " (64489, 0.5610736608505249),\n",
       " (44981, 0.5609549880027771),\n",
       " (66788, 0.5605695843696594),\n",
       " (47379, 0.5605483651161194),\n",
       " (53652, 0.5602529048919678),\n",
       " (54035, 0.559810996055603),\n",
       " (26443, 0.5596989989280701),\n",
       " (66544, 0.559650182723999),\n",
       " (55835, 0.5596223473548889),\n",
       " (59216, 0.5594369173049927),\n",
       " (45772, 0.5585065484046936),\n",
       " (56847, 0.5579932928085327),\n",
       " (53588, 0.5578727126121521),\n",
       " (60218, 0.5578470230102539),\n",
       " (51105, 0.5578111410140991),\n",
       " (37702, 0.5574700236320496),\n",
       " (47498, 0.5570836663246155),\n",
       " (62592, 0.557022750377655),\n",
       " (43900, 0.5569537281990051),\n",
       " (30970, 0.5567216277122498),\n",
       " (39498, 0.5563475489616394),\n",
       " (37174, 0.5559059977531433),\n",
       " (49867, 0.5558098554611206),\n",
       " (52029, 0.5552867650985718),\n",
       " (57989, 0.5551767349243164),\n",
       " (54541, 0.5549147725105286),\n",
       " (39774, 0.5549086332321167),\n",
       " (67001, 0.5545657873153687),\n",
       " (44884, 0.5540061593055725),\n",
       " (60226, 0.5540004372596741),\n",
       " (47777, 0.5533847212791443),\n",
       " (48871, 0.5531343221664429),\n",
       " (47459, 0.5525940656661987),\n",
       " (61250, 0.5525437593460083),\n",
       " (37373, 0.5518585443496704),\n",
       " (34490, 0.551124632358551),\n",
       " (62470, 0.550886869430542),\n",
       " (70138, 0.550629734992981),\n",
       " (67461, 0.550592303276062),\n",
       " (65126, 0.5499112606048584),\n",
       " (70224, 0.5497207045555115),\n",
       " (69208, 0.5496095418930054),\n",
       " (45077, 0.5493011474609375),\n",
       " (56585, 0.5492343902587891),\n",
       " (64510, 0.5491734743118286),\n",
       " (38096, 0.5491373538970947),\n",
       " (42330, 0.5491216778755188),\n",
       " (37849, 0.5488654971122742),\n",
       " (69217, 0.5488537549972534),\n",
       " (55440, 0.5488366484642029),\n",
       " (69397, 0.5485247373580933),\n",
       " (52027, 0.5485216975212097),\n",
       " (52158, 0.5485120415687561),\n",
       " (66082, 0.5482742190361023),\n",
       " (48068, 0.5481429696083069),\n",
       " (66495, 0.5480229258537292),\n",
       " (44985, 0.5468747615814209),\n",
       " (41117, 0.5464783310890198),\n",
       " (2884, 0.5464420914649963),\n",
       " (64501, 0.546288788318634),\n",
       " (67465, 0.5458552241325378),\n",
       " (49035, 0.5451967716217041),\n",
       " (62081, 0.5449560880661011),\n",
       " (69716, 0.5448200106620789),\n",
       " (60593, 0.5447289347648621),\n",
       " (42715, 0.5446931719779968),\n",
       " (42418, 0.5446406006813049),\n",
       " (44464, 0.5446010231971741),\n",
       " (37201, 0.5440685749053955),\n",
       " (54534, 0.5439690947532654),\n",
       " (49026, 0.5437219738960266),\n",
       " (44471, 0.543675422668457),\n",
       " (15624, 0.5433595180511475),\n",
       " (61730, 0.5429666638374329),\n",
       " (67115, 0.5429556965827942),\n",
       " (55983, 0.5422759652137756),\n",
       " (65841, 0.5421181917190552),\n",
       " (67463, 0.5420024991035461),\n",
       " (56030, 0.541913628578186),\n",
       " (40717, 0.5418298840522766),\n",
       " (69396, 0.5416303277015686),\n",
       " (37743, 0.5413236021995544),\n",
       " (62476, 0.5411122441291809),\n",
       " (67009, 0.5410708785057068),\n",
       " (53242, 0.5409402251243591),\n",
       " (36599, 0.5405803918838501),\n",
       " (37907, 0.540489673614502),\n",
       " (40878, 0.5404797196388245),\n",
       " (64506, 0.5403139591217041),\n",
       " (42691, 0.5402542352676392),\n",
       " (64974, 0.5398770570755005),\n",
       " (63868, 0.5398509502410889),\n",
       " (51444, 0.5396435856819153),\n",
       " (45155, 0.5395552515983582),\n",
       " (54537, 0.5394206047058105),\n",
       " (62372, 0.5392322540283203),\n",
       " (42042, 0.5391449928283691),\n",
       " (38164, 0.5391179323196411),\n",
       " (36994, 0.5391019582748413),\n",
       " (62537, 0.5388539433479309),\n",
       " (56594, 0.5387248992919922),\n",
       " (29854, 0.5385974049568176),\n",
       " (66079, 0.538291335105896),\n",
       " (62442, 0.5382158756256104),\n",
       " (37288, 0.5374646782875061),\n",
       " (67070, 0.5373532772064209),\n",
       " (39495, 0.5372815728187561),\n",
       " (64966, 0.5366367697715759),\n",
       " (37105, 0.536515474319458),\n",
       " (51020, 0.5364305973052979),\n",
       " (60040, 0.5362635850906372),\n",
       " (41771, 0.5362322330474854),\n",
       " (37363, 0.5361862182617188),\n",
       " (57159, 0.5360336899757385),\n",
       " (36238, 0.5360252261161804),\n",
       " (59339, 0.5356560945510864),\n",
       " (20711, 0.5354950428009033),\n",
       " (67830, 0.5353240370750427),\n",
       " (71283, 0.535237729549408),\n",
       " (38192, 0.5350692272186279),\n",
       " (52792, 0.5350656509399414),\n",
       " (71216, 0.5349607467651367),\n",
       " (71525, 0.5349122881889343),\n",
       " (62495, 0.53476881980896),\n",
       " (40722, 0.5345407128334045),\n",
       " (46503, 0.5344886779785156),\n",
       " (48799, 0.5344816446304321),\n",
       " (55828, 0.5340011715888977),\n",
       " (59909, 0.5336124897003174),\n",
       " (54862, 0.5332028269767761),\n",
       " (42413, 0.5331421494483948),\n",
       " (44533, 0.5328420996665955),\n",
       " (51451, 0.5328143835067749),\n",
       " (55709, 0.5326083898544312),\n",
       " (66545, 0.5323241949081421),\n",
       " (52431, 0.5321691632270813),\n",
       " (63914, 0.5319516658782959),\n",
       " (63968, 0.531851589679718),\n",
       " (51021, 0.531777560710907),\n",
       " (41223, 0.5315653681755066),\n",
       " (408, 0.5314416885375977),\n",
       " (43815, 0.5312765836715698),\n",
       " (71308, 0.5308696031570435),\n",
       " (49974, 0.5308102369308472),\n",
       " (43993, 0.5303415656089783),\n",
       " (51016, 0.5300174355506897),\n",
       " (40242, 0.5298351049423218),\n",
       " (71278, 0.5296889543533325),\n",
       " (54848, 0.5294274687767029),\n",
       " (40240, 0.528879702091217),\n",
       " (36436, 0.5288638472557068),\n",
       " (45160, 0.5286741256713867),\n",
       " (55470, 0.5285928845405579),\n",
       " (44544, 0.5285446047782898),\n",
       " (42581, 0.5282378196716309),\n",
       " (58056, 0.5280987024307251),\n",
       " (44238, 0.528078556060791),\n",
       " (61096, 0.5280246734619141),\n",
       " (51842, 0.5270490646362305),\n",
       " (50242, 0.526675283908844),\n",
       " (47558, 0.5266147255897522),\n",
       " (3066, 0.5262488126754761),\n",
       " (48439, 0.5262306928634644),\n",
       " (69720, 0.5252692699432373),\n",
       " (59219, 0.524808406829834),\n",
       " (66769, 0.5247381329536438),\n",
       " (6210, 0.5243383049964905),\n",
       " (59379, 0.5242979526519775),\n",
       " (66609, 0.524293065071106),\n",
       " (43896, 0.5242272615432739),\n",
       " (59782, 0.5239482522010803),\n",
       " (51258, 0.5234330296516418),\n",
       " (54803, 0.5230767130851746),\n",
       " (59904, 0.5230469703674316),\n",
       " (50371, 0.522935688495636),\n",
       " (63876, 0.5228205919265747),\n",
       " (18312, 0.5222781300544739),\n",
       " (59081, 0.5221157670021057),\n",
       " (42259, 0.5220937728881836),\n",
       " (61757, 0.5220894813537598),\n",
       " (67576, 0.5220648050308228),\n",
       " (49223, 0.5218991041183472),\n",
       " (46931, 0.521887481212616),\n",
       " (52526, 0.521884560585022),\n",
       " (62428, 0.5217754244804382),\n",
       " (62085, 0.5217210650444031),\n",
       " (60913, 0.5217172503471375),\n",
       " (53536, 0.5215070247650146),\n",
       " (49162, 0.5214881896972656),\n",
       " (42019, 0.521228551864624),\n",
       " (66991, 0.5210230946540833),\n",
       " (68395, 0.5209956169128418),\n",
       " (71645, 0.5209428071975708),\n",
       " (71359, 0.5209139585494995),\n",
       " (69977, 0.5206999182701111),\n",
       " (43096, 0.5205696225166321),\n",
       " (56088, 0.5204373002052307),\n",
       " (59785, 0.5197646021842957),\n",
       " (55716, 0.5197497010231018),\n",
       " (45049, 0.5192587375640869),\n",
       " (54578, 0.5191382765769958),\n",
       " (67472, 0.5191373229026794),\n",
       " (54266, 0.518532931804657),\n",
       " (47557, 0.518527626991272),\n",
       " (64499, 0.5181488990783691),\n",
       " (44703, 0.5178263783454895),\n",
       " (43092, 0.5175194144248962),\n",
       " (5851, 0.5174458026885986),\n",
       " (54318, 0.5173096060752869),\n",
       " (64525, 0.5171844363212585),\n",
       " (69709, 0.5171006321907043),\n",
       " (34491, 0.5170761346817017),\n",
       " (29309, 0.5168906450271606),\n",
       " (65611, 0.5168635249137878),\n",
       " (36418, 0.5166909694671631),\n",
       " (59218, 0.5159138441085815),\n",
       " (42127, 0.5159133076667786),\n",
       " (55930, 0.5158163905143738),\n",
       " (61227, 0.5158088803291321),\n",
       " (51352, 0.5155980587005615),\n",
       " (67006, 0.5154010057449341),\n",
       " (41680, 0.5152954459190369),\n",
       " (56655, 0.5152137279510498),\n",
       " (71322, 0.5146095156669617),\n",
       " (39601, 0.5141377449035645),\n",
       " (45158, 0.5139490962028503),\n",
       " (61110, 0.513903796672821),\n",
       " (70576, 0.5137835741043091),\n",
       " (62481, 0.5137332081794739),\n",
       " (10014, 0.5129709839820862),\n",
       " (51345, 0.5128990411758423),\n",
       " (31069, 0.5126604437828064),\n",
       " (51022, 0.5122368931770325),\n",
       " (60054, 0.5121380090713501),\n",
       " (26435, 0.5119361281394958),\n",
       " (63872, 0.5118536353111267),\n",
       " (71234, 0.5118175745010376),\n",
       " (59911, 0.5116822719573975),\n",
       " (44605, 0.5116692781448364),\n",
       " (56845, 0.5115336179733276),\n",
       " (58679, 0.5113210082054138),\n",
       " (58144, 0.511188268661499),\n",
       " (58048, 0.5111612677574158),\n",
       " (40895, 0.511147141456604),\n",
       " (64505, 0.5107764005661011),\n",
       " (36368, 0.5107542276382446),\n",
       " (39987, 0.5107007622718811),\n",
       " (40329, 0.5102740526199341),\n",
       " (38732, 0.5101025104522705),\n",
       " (56370, 0.5099766254425049),\n",
       " (58586, 0.5098094940185547),\n",
       " (65602, 0.5096879005432129),\n",
       " (5311, 0.5094502568244934),\n",
       " (30200, 0.5093101263046265),\n",
       " (49421, 0.5092693567276001),\n",
       " (69417, 0.5092636346817017),\n",
       " (61927, 0.509239673614502),\n",
       " (44010, 0.5091660618782043),\n",
       " (62471, 0.508942723274231),\n",
       " (61095, 0.5087469816207886),\n",
       " (19301, 0.5086885690689087),\n",
       " (52444, 0.5084459781646729),\n",
       " (42243, 0.5083194971084595),\n",
       " (59526, 0.5082351565361023),\n",
       " (60301, 0.5080457925796509),\n",
       " (53330, 0.5080180168151855),\n",
       " (60964, 0.5079765319824219),\n",
       " (61892, 0.5077899098396301),\n",
       " (47057, 0.5076800584793091),\n",
       " (66175, 0.5072301626205444),\n",
       " (66494, 0.5071011781692505),\n",
       " (55622, 0.5068751573562622),\n",
       " (43043, 0.5066417455673218),\n",
       " (65610, 0.5065690279006958),\n",
       " (42119, 0.5063707828521729),\n",
       " (49640, 0.5063185095787048),\n",
       " (63841, 0.5061846971511841),\n",
       " (38006, 0.5057182908058167),\n",
       " (66412, 0.5056899189949036),\n",
       " (34736, 0.5056807398796082),\n",
       " (43710, 0.5053843855857849),\n",
       " (66089, 0.5047395825386047),\n",
       " (46406, 0.5046389698982239),\n",
       " (66940, 0.5045638084411621),\n",
       " (55616, 0.5044675469398499),\n",
       " (51652, 0.503669023513794),\n",
       " (45052, 0.5034648180007935),\n",
       " (63905, 0.5032252669334412),\n",
       " (54003, 0.502752423286438),\n",
       " (55620, 0.5025442838668823),\n",
       " (51875, 0.5016785860061646),\n",
       " (42329, 0.5015676021575928),\n",
       " (49093, 0.501221239566803),\n",
       " (40894, 0.5010467171669006),\n",
       " (43112, 0.5010071396827698),\n",
       " (61255, 0.5009403824806213),\n",
       " (69127, 0.5007754564285278),\n",
       " (59538, 0.5006648302078247),\n",
       " (36257, 0.5005204677581787),\n",
       " (55713, 0.5003060102462769),\n",
       " (45189, 0.5001943707466125),\n",
       " (66995, 0.50017911195755),\n",
       " (63853, 0.5001774430274963),\n",
       " (41511, 0.5001745223999023),\n",
       " (69132, 0.500173807144165),\n",
       " (71453, 0.4999469518661499),\n",
       " (42578, 0.49991849064826965),\n",
       " (56859, 0.499609112739563),\n",
       " (47500, 0.4995114207267761),\n",
       " (49596, 0.4993482828140259),\n",
       " (13419, 0.49928635358810425),\n",
       " (43892, 0.49915972352027893),\n",
       " (45431, 0.49907931685447693),\n",
       " (71642, 0.49899110198020935),\n",
       " (69223, 0.4988463819026947),\n",
       " (36292, 0.4988360106945038),\n",
       " (37340, 0.4986509680747986),\n",
       " (42049, 0.49853262305259705),\n",
       " (67729, 0.4984905421733856),\n",
       " (69419, 0.4980398416519165),\n",
       " (64591, 0.49792131781578064),\n",
       " (51813, 0.4977688193321228),\n",
       " (47773, 0.49772360920906067),\n",
       " (47119, 0.4976653754711151),\n",
       " (36733, 0.49744176864624023),\n",
       " (43256, 0.49739477038383484),\n",
       " (47763, 0.49733516573905945),\n",
       " (70088, 0.49728506803512573),\n",
       " (54600, 0.49727511405944824),\n",
       " (66032, 0.4971032440662384),\n",
       " (49185, 0.49707815051078796),\n",
       " (62477, 0.4964350759983063),\n",
       " (49752, 0.49639734625816345),\n",
       " (57993, 0.49548062682151794),\n",
       " (37663, 0.4953397512435913),\n",
       " (48051, 0.49513930082321167),\n",
       " (42016, 0.49478814005851746),\n",
       " (61888, 0.49463000893592834),\n",
       " (58641, 0.4946049451828003),\n",
       " (36686, 0.4945427179336548),\n",
       " (62645, 0.4944278597831726),\n",
       " (15021, 0.49437642097473145),\n",
       " (46930, 0.49430733919143677),\n",
       " (51009, 0.49414438009262085),\n",
       " (40810, 0.49388158321380615),\n",
       " (46962, 0.4936397075653076),\n",
       " (53655, 0.49348002672195435),\n",
       " (66768, 0.4933117926120758),\n",
       " (6239, 0.4932636022567749),\n",
       " (50854, 0.49313172698020935),\n",
       " (55151, 0.49311161041259766),\n",
       " (48035, 0.49310076236724854),\n",
       " (59906, 0.4930618703365326),\n",
       " (53596, 0.4930056035518646),\n",
       " (58681, 0.4923887252807617),\n",
       " (48792, 0.49230727553367615),\n",
       " (52919, 0.4922213554382324),\n",
       " (59912, 0.4919167160987854),\n",
       " (61854, 0.49182868003845215),\n",
       " (53889, 0.49174824357032776),\n",
       " (4513, 0.4916779398918152),\n",
       " (69340, 0.49152156710624695),\n",
       " (47056, 0.4912753105163574),\n",
       " (62405, 0.49117767810821533),\n",
       " (28644, 0.4911321997642517),\n",
       " (36661, 0.4904806315898895),\n",
       " (70103, 0.4903068542480469),\n",
       " (39605, 0.4902172386646271),\n",
       " (47504, 0.4901857078075409),\n",
       " (59789, 0.4899579584598541),\n",
       " (18927, 0.4898013472557068),\n",
       " (66136, 0.4896082282066345),\n",
       " (39506, 0.48936235904693604),\n",
       " (44988, 0.4888983368873596),\n",
       " (26387, 0.4886469542980194),\n",
       " (47973, 0.48854950070381165),\n",
       " (50536, 0.4884342551231384),\n",
       " (42669, 0.48779305815696716),\n",
       " (47513, 0.48763611912727356),\n",
       " (55822, 0.48757532238960266),\n",
       " (54021, 0.48746541142463684),\n",
       " (47120, 0.4873811602592468),\n",
       " (64173, 0.4870406687259674),\n",
       " (37606, 0.4869591295719147),\n",
       " (68265, 0.48688632249832153),\n",
       " (14060, 0.48679113388061523),\n",
       " (55950, 0.4867877960205078),\n",
       " (66456, 0.4866972863674164),\n",
       " (61067, 0.4865138530731201),\n",
       " (38342, 0.48636165261268616),\n",
       " (47713, 0.48632416129112244),\n",
       " (71633, 0.4856420159339905),\n",
       " (55471, 0.48560115694999695),\n",
       " (45565, 0.4855727553367615),\n",
       " (63965, 0.485365629196167),\n",
       " (51184, 0.48536041378974915),\n",
       " (38506, 0.4853089153766632),\n",
       " (68002, 0.48524487018585205),\n",
       " (58756, 0.4851512312889099),\n",
       " (45301, 0.4850940704345703),\n",
       " (52916, 0.48502981662750244),\n",
       " (39334, 0.4847877025604248),\n",
       " (46244, 0.4847854971885681),\n",
       " (54315, 0.4847285747528076),\n",
       " (44179, 0.48471495509147644),\n",
       " (53598, 0.4843924939632416),\n",
       " (56858, 0.4842856526374817),\n",
       " (46940, 0.4842514991760254),\n",
       " (44828, 0.48416632413864136),\n",
       " (18892, 0.48414313793182373),\n",
       " (55348, 0.4840441942214966),\n",
       " (67063, 0.4838564991950989),\n",
       " (358, 0.4838341176509857),\n",
       " (49071, 0.48377758264541626),\n",
       " (60651, 0.48373502492904663),\n",
       " (42701, 0.4836723208427429),\n",
       " (62263, 0.48361891508102417),\n",
       " (67199, 0.4835670590400696),\n",
       " (57149, 0.4832320511341095),\n",
       " (68072, 0.4831138551235199),\n",
       " (62595, 0.4830910563468933),\n",
       " (61932, 0.4829702079296112),\n",
       " (58444, 0.4829651415348053),\n",
       " (53326, 0.48294782638549805),\n",
       " (70786, 0.48290812969207764),\n",
       " (61235, 0.48281028866767883),\n",
       " (41073, 0.4827742278575897),\n",
       " (2941, 0.48275667428970337),\n",
       " (44249, 0.4824802577495575),\n",
       " (37232, 0.4824218153953552),\n",
       " (36195, 0.48234525322914124),\n",
       " (17308, 0.4823196530342102),\n",
       " (62228, 0.4823145866394043),\n",
       " (65625, 0.4822705388069153),\n",
       " (61906, 0.48226240277290344),\n",
       " (45771, 0.4821166396141052),\n",
       " (39231, 0.4817509055137634),\n",
       " (45053, 0.48165255784988403),\n",
       " (70311, 0.4814424514770508),\n",
       " (67903, 0.4813999533653259),\n",
       " (64757, 0.481381893157959),\n",
       " (58364, 0.4811016917228699),\n",
       " (8838, 0.48105984926223755),\n",
       " (36923, 0.48080459237098694),\n",
       " (62987, 0.48068857192993164),\n",
       " (52423, 0.48056527972221375),\n",
       " (51011, 0.48034045100212097),\n",
       " (22994, 0.48031705617904663),\n",
       " (55843, 0.4802003502845764),\n",
       " (61930, 0.4798494875431061),\n",
       " (53709, 0.4794822633266449),\n",
       " (43534, 0.4794107675552368),\n",
       " (45682, 0.4791386127471924),\n",
       " (55761, 0.4789975583553314),\n",
       " (39606, 0.4789442718029022),\n",
       " (54845, 0.47892847657203674),\n",
       " (61936, 0.478426069021225),\n",
       " (56465, 0.4783313572406769),\n",
       " (37935, 0.4783041179180145),\n",
       " (67005, 0.4782356917858124),\n",
       " (35345, 0.4781358540058136),\n",
       " (55345, 0.4780082106590271),\n",
       " (43986, 0.4779994487762451),\n",
       " (62398, 0.4779835343360901),\n",
       " (51008, 0.4779779613018036),\n",
       " (55423, 0.477659672498703),\n",
       " (45627, 0.4776058495044708),\n",
       " (18304, 0.47760263085365295),\n",
       " (53509, 0.47744616866111755),\n",
       " (60472, 0.47740328311920166),\n",
       " (66402, 0.47723492980003357),\n",
       " (67831, 0.47717463970184326),\n",
       " (35595, 0.4771610200405121),\n",
       " (64975, 0.477157324552536),\n",
       " (51612, 0.4770103693008423),\n",
       " (71202, 0.4769677519798279),\n",
       " (18898, 0.47665855288505554),\n",
       " (44472, 0.47657203674316406),\n",
       " (36548, 0.47647032141685486),\n",
       " (55425, 0.4763615131378174),\n",
       " (3280, 0.476346492767334),\n",
       " (57047, 0.47633427381515503),\n",
       " (49727, 0.47616687417030334),\n",
       " (44182, 0.476083904504776),\n",
       " (42579, 0.47601765394210815),\n",
       " (62473, 0.4759809970855713),\n",
       " (53629, 0.47583165764808655),\n",
       " (37970, 0.47580981254577637),\n",
       " (54046, 0.4757890999317169),\n",
       " (51349, 0.4752841293811798),\n",
       " (62415, 0.47524696588516235),\n",
       " (54542, 0.4752200245857239),\n",
       " (54334, 0.4749215841293335),\n",
       " (65587, 0.4748794138431549),\n",
       " (49771, 0.47470757365226746),\n",
       " (47169, 0.474524587392807),\n",
       " (63507, 0.474286288022995),\n",
       " (36104, 0.4742391109466553),\n",
       " (65593, 0.4742164611816406),\n",
       " (60756, 0.47407835721969604),\n",
       " (37210, 0.4740539789199829),\n",
       " (1340, 0.4740213453769684),\n",
       " (54116, 0.47400233149528503),\n",
       " (37488, 0.4737511873245239),\n",
       " (51006, 0.4737338423728943),\n",
       " (62444, 0.47360020875930786),\n",
       " (69220, 0.4735581874847412),\n",
       " (61933, 0.4734002947807312),\n",
       " (43669, 0.4731290936470032),\n",
       " (65411, 0.4729725122451782),\n",
       " (66114, 0.47271543741226196),\n",
       " (58816, 0.47247371077537537),\n",
       " (55627, 0.4722418785095215),\n",
       " (68977, 0.47223415970802307),\n",
       " (41756, 0.4721766412258148),\n",
       " (55381, 0.47207656502723694),\n",
       " (65202, 0.4720748960971832),\n",
       " (48381, 0.47195756435394287),\n",
       " (25299, 0.47191858291625977),\n",
       " (45574, 0.4718283712863922),\n",
       " (69225, 0.47174501419067383),\n",
       " (65743, 0.47171640396118164),\n",
       " (53659, 0.47168344259262085),\n",
       " (56854, 0.47152116894721985),\n",
       " (70915, 0.47151979804039),\n",
       " (66183, 0.47105085849761963),\n",
       " (63092, 0.4710375666618347),\n",
       " (12490, 0.4708864092826843),\n",
       " (675, 0.4708472192287445),\n",
       " (21260, 0.470812052488327),\n",
       " (48128, 0.47075024247169495),\n",
       " (140, 0.47070369124412537),\n",
       " (43082, 0.47065386176109314),\n",
       " (44469, 0.47065022587776184),\n",
       " (42060, 0.4703720808029175),\n",
       " (63858, 0.47032153606414795),\n",
       " (42091, 0.47029438614845276),\n",
       " (64490, 0.4702112078666687),\n",
       " (54570, 0.47014445066452026),\n",
       " (65744, 0.4701046049594879),\n",
       " (56157, 0.469688355922699),\n",
       " (7764, 0.46968764066696167),\n",
       " (7763, 0.4692975878715515),\n",
       " (56443, 0.4691214859485626),\n",
       " (41260, 0.4690588414669037),\n",
       " (48631, 0.469045490026474),\n",
       " (15027, 0.46897926926612854),\n",
       " (50847, 0.46897146105766296),\n",
       " (49808, 0.46892377734184265),\n",
       " (71375, 0.46891796588897705),\n",
       " (49324, 0.46884685754776),\n",
       " (42690, 0.46879780292510986),\n",
       " (43103, 0.4686680734157562),\n",
       " (43105, 0.4684664309024811),\n",
       " (66093, 0.46837884187698364),\n",
       " (44460, 0.4683045744895935),\n",
       " (56192, 0.4680701494216919),\n",
       " (7118, 0.4679561257362366),\n",
       " (65839, 0.4679442048072815),\n",
       " (2547, 0.46772223711013794),\n",
       " (34730, 0.4676923453807831),\n",
       " (64791, 0.46755897998809814),\n",
       " (44462, 0.46755731105804443),\n",
       " (55984, 0.46752113103866577),\n",
       " (61948, 0.4674166738986969),\n",
       " (69726, 0.46735045313835144),\n",
       " (9750, 0.4672602713108063),\n",
       " (53814, 0.4671729505062103),\n",
       " (3071, 0.46713006496429443),\n",
       " (1743, 0.4670987129211426),\n",
       " (36908, 0.467092365026474),\n",
       " (46026, 0.4669533371925354),\n",
       " (55252, 0.46692582964897156),\n",
       " (61887, 0.46664032340049744),\n",
       " (54042, 0.4666249454021454),\n",
       " (69577, 0.46660658717155457),\n",
       " (64712, 0.4664406180381775),\n",
       " (62270, 0.4663621783256531),\n",
       " (38171, 0.4663297235965729),\n",
       " (51762, 0.46622583270072937),\n",
       " (66500, 0.46620070934295654),\n",
       " (52525, 0.4660961925983429),\n",
       " (52933, 0.4660133123397827),\n",
       " (63813, 0.46585389971733093),\n",
       " (49081, 0.465612530708313),\n",
       " (414, 0.46554040908813477),\n",
       " (62261, 0.4654881954193115),\n",
       " (43087, 0.4652005434036255),\n",
       " (8834, 0.465175062417984),\n",
       " (42665, 0.46511539816856384),\n",
       " (57015, 0.46467167139053345),\n",
       " (56187, 0.46465688943862915),\n",
       " (55180, 0.4646511971950531),\n",
       " (56823, 0.46460697054862976),\n",
       " (43035, 0.46452680230140686),\n",
       " (61950, 0.4645260274410248),\n",
       " (63859, 0.46450990438461304),\n",
       " (36409, 0.4644957482814789),\n",
       " (60373, 0.4643721282482147),\n",
       " (63838, 0.46434688568115234),\n",
       " (51955, 0.46427202224731445),\n",
       " (49100, 0.4642675518989563),\n",
       " (67555, 0.46409812569618225),\n",
       " (41290, 0.464039146900177),\n",
       " (27859, 0.46400126814842224),\n",
       " (24053, 0.46393507719039917),\n",
       " (66492, 0.4637008011341095),\n",
       " (60137, 0.4635929763317108),\n",
       " (61305, 0.4635637402534485),\n",
       " (43260, 0.46347638964653015),\n",
       " (57556, 0.4634556472301483),\n",
       " (63848, 0.4632507860660553),\n",
       " (68646, 0.4632376432418823),\n",
       " (51182, 0.46309277415275574),\n",
       " (60951, 0.46306437253952026),\n",
       " (39465, 0.462831974029541),\n",
       " (55248, 0.46272891759872437),\n",
       " (57701, 0.4627193212509155),\n",
       " (17570, 0.46262025833129883),\n",
       " (48120, 0.46232303977012634),\n",
       " (43136, 0.46209052205085754),\n",
       " (41289, 0.4620148837566376),\n",
       " (50391, 0.46195361018180847),\n",
       " (20705, 0.4618791341781616),\n",
       " (64514, 0.4617384970188141),\n",
       " (59093, 0.4616917669773102),\n",
       " (47758, 0.46156007051467896),\n",
       " (14513, 0.46153387427330017),\n",
       " (38494, 0.46151992678642273),\n",
       " (66937, 0.4613422155380249),\n",
       " (69087, 0.46130484342575073),\n",
       " (67262, 0.46126866340637207),\n",
       " (41091, 0.4610702097415924),\n",
       " (40842, 0.4610632061958313),\n",
       " (71311, 0.46094444394111633),\n",
       " (68169, 0.46085065603256226),\n",
       " (553, 0.4605514109134674),\n",
       " (9928, 0.4604916572570801),\n",
       " (41518, 0.46047335863113403),\n",
       " (31617, 0.46039867401123047),\n",
       " (41751, 0.4603775441646576),\n",
       " (61433, 0.4602464437484741),\n",
       " (2198, 0.460170179605484),\n",
       " (61070, 0.4600488841533661),\n",
       " (39603, 0.45995768904685974),\n",
       " (24951, 0.45986926555633545),\n",
       " (58684, 0.4596690535545349),\n",
       " (45435, 0.4595469832420349),\n",
       " (42550, 0.4593583941459656),\n",
       " (46724, 0.4592853784561157),\n",
       " (30535, 0.4592556953430176),\n",
       " (24048, 0.45905399322509766),\n",
       " (40846, 0.45882678031921387),\n",
       " (44209, 0.4587821364402771),\n",
       " (61939, 0.458713561296463),\n",
       " (38814, 0.45860299468040466),\n",
       " (61748, 0.4586026966571808),\n",
       " (60142, 0.45857495069503784),\n",
       " (1506, 0.45841750502586365),\n",
       " (68687, 0.458249032497406),\n",
       " (28689, 0.4582424759864807),\n",
       " (59786, 0.4580412805080414),\n",
       " (71643, 0.4580096900463104),\n",
       " (37752, 0.4579261243343353),\n",
       " (26781, 0.45792356133461),\n",
       " (41828, 0.4578322470188141),\n",
       " (27083, 0.45775678753852844),\n",
       " (16403, 0.4576887786388397),\n",
       " (67218, 0.45763567090034485),\n",
       " (64503, 0.45737335085868835),\n",
       " (38069, 0.4573519825935364),\n",
       " (44245, 0.4572252631187439),\n",
       " (37779, 0.4571995139122009),\n",
       " (62486, 0.45708805322647095),\n",
       " (66363, 0.4565664231777191),\n",
       " (61853, 0.45632240176200867),\n",
       " (54596, 0.45628803968429565),\n",
       " (67875, 0.45591118931770325),\n",
       " (62832, 0.45590367913246155),\n",
       " (9940, 0.4558199346065521),\n",
       " (53286, 0.4557601511478424),\n",
       " (45761, 0.45564669370651245),\n",
       " (66094, 0.45561841130256653),\n",
       " (41547, 0.45558127760887146),\n",
       " (41815, 0.45546916127204895),\n",
       " (40239, 0.45545509457588196),\n",
       " (66091, 0.45537686347961426),\n",
       " (36189, 0.4553459584712982),\n",
       " (52037, 0.45531314611434937),\n",
       " (71635, 0.45519113540649414),\n",
       " (54036, 0.45513421297073364),\n",
       " (48133, 0.4551139175891876),\n",
       " (44467, 0.45508620142936707),\n",
       " (186, 0.45501017570495605),\n",
       " (62575, 0.4549075663089752),\n",
       " (55228, 0.45480602979660034),\n",
       " (5599, 0.4547862410545349),\n",
       " (47287, 0.45478013157844543),\n",
       " (64492, 0.4545682668685913),\n",
       " ...]"
      ]
     },
     "execution_count": 854,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "similar_to_new"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 856,
   "id": "171e643d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'sawmill_machine_operator remove inadequate workpieces, dispose of cutting waste material, work safely with machines, keep sawing equipment in good condition, supply machine, operate wood sawing equipment, monitor automated machines, troubleshoot, manipulate wood, ensure conformity to specifications, types of wood, woodworking processes, handle timber, wear appropriate protective gear, cutting technologies, remove processed workpiece, handle timber-based products, adjust cut sizes, create cutting plan, ensure equipment availability, wood cuts, perform test run'"
      ]
     },
     "execution_count": 856,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "X_all[56860]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 855,
   "id": "a694d074",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Test Document (695): management consultancy specialized food beverage consulting services restaurants bars\n",
      "\n",
      "LISTING 3 MOST SIMILAR JOB ROLES & DESCRIPTIONS \n",
      "\n",
      "* MOST SIMILAR: sawmill machine operator\n",
      "sawmill operator work with automated lumber mill equipment which saws timber into rough lumber. they also handle various sawing car which further process the lumber in various shapes and sizes. these processes are nowadays often estimator controlled.\n",
      "Similarity score: 77.8 % \n",
      "\n",
      "* 2ND MOST SIMILAR: cnc metal engraving machine operator\n",
      "engraving auto operator set up, programme, and tend engraving machines designed to precisely carve a design in the airfoil of a metal workpiece by a infield stylus on the mechanical cutting auto that creates small, separate printing acid existing from cut cells. they read engraving machine design and tooling instructions, perform regular auto maintenance, and make registration to the precise engraving controls, such as the depth of the incision and the etching speed.\n",
      "Similarity score: 76.4 % \n",
      "\n",
      "* 3RD MOST SIMILAR: optoelectronic engineering technician\n",
      "optoelectronic engineering technicians collaborate with engineer in the exploitation of optoelectronic systems and components, such as photodiodes, optical sensors, laser and led's. optoelectronic engineering technicians build, test, install and calibrate optoelectronic equipment. they read design and other technical draftsmanship to develop testing and calibrating procedures.\n",
      "Similarity score: 76.0 % \n",
      "\n"
     ]
    }
   ],
   "source": [
    "print('Test Document ({}): {}\\n'.format(doc_id, ' '.join(new_description)))\n",
    "print('LISTING 3 MOST SIMILAR JOB ROLES & DESCRIPTIONS \\n')\n",
    "\n",
    "for label, index in [('* MOST SIMILAR', 0), ('* 2ND MOST SIMILAR', 1), ('* 3RD MOST SIMILAR', 2)]:\n",
    "\n",
    "    if similar_to_new[index][0] < len(df_occ_n_skills):\n",
    "        new_index = similar_to_new[index][0]\n",
    "    else:\n",
    "        new_index = similar_to_new[index][0] - len(df_occ_n_skills)\n",
    "\n",
    "    print(label + ': ' + df_occ_n_skills.loc[new_index]['job_title'])\n",
    "    print(df_occ_n_skills.loc[new_index]['description'])\n",
    "    print(f'Similarity score: {round(similar_to_new[index][1]*100,1)} % \\n')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 660,
   "id": "721ee6b7",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "LISTING 3 MOST SIMILAR JOB ROLES & DESCRIPTIONS -- NOW WITH ESCO SKILLS \n",
      "\n",
      "* MOST SIMILAR: mining hydrologist\n",
      "mining geotechnical engineers in mining perform engineering, hydrological and geological test and psychoanalysis to improve the refuge and efficiency of mineral operations. they oversee the assemblage of sampling and the taking of measurement using geotechnical investigation method and techniques. they model the mechanical behavior of the rock passel and contribute to the design of the mine geometry.\n",
      "Similarity score: 55.2 % \n",
      "\n",
      "* 2ND MOST SIMILAR: engine design technologist\n",
      "engine architect carry out engineering responsibility in designing mechanical equipment such as auto and all case of engines. they also supervise their facility and maintenance.\n",
      "Similarity score: 49.1 % \n",
      "\n",
      "* 3RD MOST SIMILAR: nuclear engineers\n",
      "nuclear engineer plan and invention engineering equipment and summons in nuclear plant and sites. they engage in engineering activities pertaining to nuclear index plants, and develop peril solutions.\n",
      "Similarity score: 48.8 % \n",
      "\n"
     ]
    }
   ],
   "source": [
    "# now we will:\n",
    "# 1. take the jobs we got from the previous model run,\n",
    "# 2. pass them through the ESCO API,\n",
    "# 3. extract the skills they're associated with, \n",
    "# 4. append those skills to the input job description (\"describe_your_job\")\n",
    "# 5. preprocess and run the model again!\n",
    "\n",
    "url = \"https://ec.europa.eu/esco/api/resource/skill\"\n",
    "\n",
    "job_description_w_skills = describe_your_job\n",
    "\n",
    "for index in range(3):\n",
    "    \n",
    "    # get URI of each of the suggested jobs\n",
    "    suggested_job_uri = df_occupations_aug.loc[similar_to_new[index][0]]['conceptUri']\n",
    "    \n",
    "    # pass them through ESCO API\n",
    "    params = {'uri': suggested_job_uri, 'language': 'en'}\n",
    "    api_skills = requests.get(url=url, params=params).json()\n",
    "    time.sleep(1) # keeping the API happy :)\n",
    "    \n",
    "    # gets a list of all skill descriptions and extracts the skill title only\n",
    "    api_skills_dict = api_skills.get('_links').get('hasEssentialSkill')\n",
    "    skills_list = [skill.get('title') for skill in api_skills_dict]\n",
    "\n",
    "    # appends skills to the job description you gave us :)\n",
    "    job_description_w_skills = job_description_w_skills + ' ' + ' '.join(skills_list)\n",
    "    \n",
    "# preprocess & infer vector again and get new similar jobs\n",
    "new_description_w_skills = preprocessing(job_description_w_skills)\n",
    "new_inferred_vector_w_skills = job2vec_model.infer_vector(new_description_w_skills)\n",
    "similar_to_new_w_skills = job2vec_model.dv.most_similar([new_inferred_vector_w_skills], topn=len(job2vec_model.dv))\n",
    "\n",
    "# run model again\n",
    "print('LISTING 3 MOST SIMILAR JOB ROLES & DESCRIPTIONS -- NOW WITH ESCO SKILLS \\n')\n",
    "for label, index in [('* MOST SIMILAR', 0), ('* 2ND MOST SIMILAR', 1), ('* 3RD MOST SIMILAR', 2)]:\n",
    "    print(label + ': ' + df_occupations_aug.loc[similar_to_new_w_skills[index][0]]['preferredLabel'])\n",
    "    print(df_occupations_aug.loc[similar_to_new_w_skills[index][0]]['description'])\n",
    "    print(f'Similarity score: {round(similar_to_new_w_skills[index][1]*100,1)} % \\n')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2dea6a37",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.12"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
